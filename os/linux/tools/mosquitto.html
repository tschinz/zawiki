
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mosquitto &#8212; Z-Notes</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/theme_overrides.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/default.js"></script>
    <script src="../../../_static/wavedrom.min.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Raid" href="raid.html" />
    <link rel="prev" title="Let’s Encrypt" href="lets_encrypt.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../index.html">
  <img src="../../../_static/logo.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../index.html">
  OS
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../tools/index.html">
  Tools
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../coding/index.html">
  Coding
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../computerscience/index.html">
  Computerscience
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../hw/index.html">
  Hardware
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../multimedia/index.html">
  Multimedia
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../security/index.html">
  Security
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../about/index.html">
  About
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/tschinz/znotes" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/tschinz" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Don't panic, search" aria-label="Don't panic, search" autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p class="caption">
 <span class="caption-text">
  Operating Systems
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Linux
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../commandline/index.html">
     Commandline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scripts/index.html">
     Scripts
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Tools
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="apache.html">
       Apache
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hw_sensors.html">
       Hardware Sensors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="lets_encrypt.html">
       Let’s Encrypt
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Mosquitto
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="raid.html">
       Raid
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="samba.html">
       Samba
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="shairport.html">
       Shairport
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="subsonic.html">
       Subsonic
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="systemd.html">
       Systemd
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="vim.html">
       VIM
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="vnc.html">
       VNC Remote Control
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="vpn.html">
       VPN Virtual Private Network
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ubuntu/index.html">
     Ubuntu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rpi/index.html">
     Raspberry Pi
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../filesystem/index.html">
     Filesystem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../mac/index.html">
   Mac
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../win/index.html">
   Windows
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   Usage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configuration">
   Configuration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#password-file">
   Password file
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#python-example">
   Python example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paho-return-codes">
     Paho Return Codes
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/tschinz/znotes/edit/master/source/os/linux/tools/mosquitto.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="mosquitto">
<h1>Mosquitto<a class="headerlink" href="#mosquitto" title="Permalink to this headline">¶</a></h1>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../_images/mosquitto.svg"><img alt="../../../_images/mosquitto.svg" src="../../../_images/mosquitto.svg" width="40%" /></a>
</div>
<p>Eclipse Mosquitto is an open source (EPL/EDL licensed) message broker that implements the MQTT protocol versions 5.0, 3.1.1 and 3.1. Mosquitto is lightweight and is suitable for use on all devices from low power single board computers to full servers.</p>
<p>The MQTT protocol provides a lightweight method of carrying out messaging using a publish/subscribe model. This makes it suitable for Internet of Things messaging such as with low power sensors or mobile devices such as phones, embedded computers or microcontrollers.</p>
<p>The Mosquitto project also provides a C library for implementing MQTT clients, and the very popular mosquitto_pub and mosquitto_sub command line MQTT clients.</p>
<p>For more information see <a class="reference external" href="https://mosquitto.org">https://mosquitto.org</a></p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install mosquitto
sudo apt-get install mosquitto-clients
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo service mosquitto stop
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo service mosquitto start
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Default configuration can be found at:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/etc/mosquitto/mosquitto.conf
</pre></div>
</div>
<p>Example config file can be found at:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/usr/share/doc/mosquitto/examples/mosquitto.conf.example
</pre></div>
</div>
<p>Custom config file needs to be placed at</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/etc/mosquitto/conf.d/
</pre></div>
</div>
</div>
<div class="section" id="password-file">
<h2>Password file<a class="headerlink" href="#password-file" title="Permalink to this headline">¶</a></h2>
<p>Create a new password file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create empty password file</span>
touch /etc/mosquitto/mosquitto_passwd
<span class="c1"># Fill password file</span>
mosquitto_passwd -c /etc/mosquitto/mosquitto_passwd username password
</pre></div>
</div>
<p>To add a new user to the existing password file use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mosquitto_passwd -b /etc/mosquitto/mosquitto_passwd username password
</pre></div>
</div>
<p>For activating the passwordfile you need to create a custom config file <code class="docutils literal notranslate"><span class="pre">/etc/mosquitto/conf.d/mosquitto.conf</span></code> and att the following lines:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>allow_anonymous <span class="nb">false</span>
password_file /etc/mosquitto/mosquitto_passwd
</pre></div>
</div>
</div>
<div class="section" id="python-example">
<h2>Python example<a class="headerlink" href="#python-example" title="Permalink to this headline">¶</a></h2>
<p>More informations at <a class="reference external" href="http://www.steves-internet-guide.com/client-connections-python-mqtt/">http://www.steves-internet-guide.com/client-connections-python-mqtt/</a></p>
<p>Install the <code class="docutils literal notranslate"><span class="pre">paho-mqtt</span></code> library</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo pip3 install paho-mqtt
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">paho.mqtt.client</span> <span class="k">as</span> <span class="nn">mqtt</span>

<span class="c1"># connection callback</span>
<span class="k">def</span> <span class="nf">on_connect</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connected with result code &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rc</span><span class="p">))</span>

<span class="c1"># message received callback</span>
<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">topic</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">payload</span><span class="p">))</span>
   <span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;/out&quot;</span><span class="p">,</span> <span class="s2">&quot;received an input...&quot;</span><span class="p">)</span>

<span class="c1"># set up the client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">mqtt</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="n">on_connect</span>
<span class="n">client</span><span class="o">.</span><span class="n">on_message</span> <span class="o">=</span> <span class="n">on_message</span>
<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;mqtt.eclipse.org&quot;</span><span class="p">,</span> <span class="mi">1883</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span> <span class="c1"># address ip, port number, keep alive</span>

<span class="c1"># subscribe</span>
<span class="n">client</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s2">&quot;/in&quot;</span><span class="p">)</span>

<span class="c1"># process the MQTT business</span>
<span class="n">client</span><span class="o">.</span><span class="n">loop_forever</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="paho-return-codes">
<h3>Paho Return Codes<a class="headerlink" href="#paho-return-codes" title="Permalink to this headline">¶</a></h3>
<p>Connection Return Codes</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code>: Connection successful</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code>: Connection refused – incorrect protocol version</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code>: Connection refused – invalid client identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code>: Connection refused – server unavailable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4</span></code>: Connection refused – bad username or password</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">5</span></code>: Connection refused – not authorised</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">6</span></code>-<code class="docutils literal notranslate"><span class="pre">255</span></code>: Currently unused.</p></li>
</ul>
<p><a class="search-tag reference external" href="/search.html?q=os&amp;check_keywords=yes&amp;area=default">os</a>
<a class="search-tag reference external" href="/search.html?q=linux&amp;check_keywords=yes&amp;area=default">linux</a>
<a class="search-tag reference external" href="/search.html?q=tools&amp;check_keywords=yes&amp;area=default">tools</a>
<a class="search-tag reference external" href="/search.html?q=mosquitto&amp;check_keywords=yes&amp;area=default">mosquitto</a></p>
</div>
</div>
</div>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

              </div>
              
              
          </main>
          

      </div>
    </div>
    
  <script src="../../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-20699788-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      

<a class="navbar-brand" href="../../../index.html">
  <img src="../../../_static/logo.svg" class="logo" alt="logo">
</a>


    </div>
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2004-2021, tschinz.<br/>
</p>
    </div>
    
    <div class="footer-item">
      <!-- This will display the version of the docs -->

    </div>
    
  </div>
</footer>
  </body>
</html>