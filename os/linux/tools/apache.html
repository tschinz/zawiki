

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Apache &#8212; Zawiki</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/theme_overrides.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/copy_button.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/default.js"></script>
    <script src="../../../_static/wavedrom.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Hardware Sensors" href="hw_sensors.html" />
    <link rel="prev" title="Tools" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../../../index.html">
      <img src="../../../_static/logo.svg" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item active">
            <a class="nav-link" href="../../index.html">OS</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../tools/index.html">Tools</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../programming/index.html">Programming</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../boards/index.html">Dev Boards</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../writing/index.html">Writing</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../multimedia/index.html">Multimedia</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../security/index.html">Security</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../about/index.html">About</a>
        </li>
        
        
        <li class="nav-item">
            <a class="nav-link nav-external" href="https://github.com/tschinz/config">Config repo<i class="fas fa-external-link-alt"></i></a>
        </li>
        
      </ul>


      <form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Don't panic, search" aria-label="Don't panic, search" autocomplete="off" >
</form>
      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/tschinz/zawiki" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/tschinz" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">



<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
        
          

              <li class="active">
                  <a href="../index.html">Linux</a>
                  <ul>
                  
                      <li class="">
                          <a href="../commandline/index.html">Commandline</a>
                      </li>
                  
                      <li class="">
                          <a href="../scripts/index.html">Scripts</a>
                      </li>
                  
                      <li class="active">
                          <a href="index.html">Tools</a>
                      </li>
                  
                      <li class="">
                          <a href="../ubuntu/index.html">Ubuntu</a>
                      </li>
                  
                      <li class="">
                          <a href="../rpi/index.html">Raspberry Pi</a>
                      </li>
                  
                      <li class="">
                          <a href="../filesystem/index.html">Filesystem</a>
                      </li>
                  
                  </ul>
              </li>
          
        
          
              <li class="">
                  <a href="../../mac/index.html">Mac</a>
              </li>
          
        
          
              <li class="">
                  <a href="../../win/index.html">Windows</a>
              </li>
          
        
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#password-protect-apache-pages" class="nav-link">Password Protect Apache Pages</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#install-apache-packages" class="nav-link">Install Apache Packages</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#create-the-password-file" class="nav-link">Create the Password File</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#configure-apache-password-authentication" class="nav-link">Configure Apache Password Authentication</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#access-control-in-virtual-host" class="nav-link">Access Control in Virtual Host</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>



<div class="tocsection editthispage">
    <a href="https://github.com/tschinz/zawiki/edit/master/source/os/linux/tools/apache.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="apache">
<h1>Apache<a class="headerlink" href="#apache" title="Permalink to this headline">¶</a></h1>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../_images/apache.svg"><img alt="../../../_images/apache.svg" src="../../../_images/apache.svg" width="300px" /></a>
</div>
<div class="section" id="password-protect-apache-pages">
<h2>Password Protect Apache Pages<a class="headerlink" href="#password-protect-apache-pages" title="Permalink to this headline">¶</a></h2>
<p>When setting up a web server, there are often sections of the site that you wish to restrict access to. Web applications often provide their own authentication and authorization methods, but the web server itself can be used to restrict access if these are inadequate or unavailable.</p>
<p>In order to create the file that will store the passwords needed to access our restricted content, we will use a utility called htpasswd. This is found in the <code class="docutils literal notranslate"><span class="pre">apache2-utils</span></code> package within the Ubuntu repositories.</p>
<div class="section" id="install-apache-packages">
<h3>Install Apache Packages<a class="headerlink" href="#install-apache-packages" title="Permalink to this headline">¶</a></h3>
<p>Update the local package cache and install the package by typing this command. We will take this opportunity to also grab the Apache2 server in case it is not yet installed on the server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get update
sudo apt-get install apache2 apache2-utils
</pre></div>
</div>
</div>
<div class="section" id="create-the-password-file">
<h3>Create the Password File<a class="headerlink" href="#create-the-password-file" title="Permalink to this headline">¶</a></h3>
<p>We now have access to the <code class="docutils literal notranslate"><span class="pre">htpasswd</span></code> command. We can use this to create a password file that Apache can use to authenticate users. We will create a hidden file for this purpose called <code class="docutils literal notranslate"><span class="pre">.htpasswd</span></code> within our <code class="docutils literal notranslate"><span class="pre">/etc/apache2</span></code> configuration directory.</p>
<p>The first time we use this utility, we need to add the <code class="docutils literal notranslate"><span class="pre">-c</span></code> option to create the specified file. We specify a username (test in this example) at the end of the command to create a new entry within the file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo htpasswd -c /etc/apache2/.htpasswd <span class="nb">test</span>
</pre></div>
</div>
<p>You will be asked to supply and confirm a password for the user.</p>
<p>Leave out the <code class="docutils literal notranslate"><span class="pre">-c</span></code> argument for any additional users you wish to add:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo htpasswd /etc/apache2/.htpasswd another_user
</pre></div>
</div>
<p>If we view the contents of the file, we can see the username and the encrypted password for each record:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /etc/apache2/.htpasswd
</pre></div>
</div>
<p><strong>Output</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>test:$apr1$lzxsIfXG$tmCvCfb49vpPFwKGVsuYz.
another_user:$apr1$p1E9MeAf$kiAhneUwr.MhAE2kKGYHK.
</pre></div>
</div>
</div>
<div class="section" id="configure-apache-password-authentication">
<h3>Configure Apache Password Authentication<a class="headerlink" href="#configure-apache-password-authentication" title="Permalink to this headline">¶</a></h3>
<p>Now that we have a file with our users and passwords in a format that Apache can read, we need to configure Apache to check this file before serving our protected content. We can do this in two different ways.</p>
<p>The first option is to edit the Apache configuration and add our password protection to the virtual host file. This will generally give better performance because it avoids the expense of reading distributed configuration files. If you have this option, this method is recommended.</p>
<p>If you do not have the ability to modify the virtual host file (or if you are already using .htaccess files for other purposes), you can restrict access using an <code class="docutils literal notranslate"><span class="pre">.htaccess</span></code> file. Apache uses <code class="docutils literal notranslate"><span class="pre">.htaccess</span></code> files in order to allow certain configuration items to be set within a file in a content directory. The disadvantage is that Apache has to re-read these files on every request that involves the directory, which can impact performance.</p>
<p>Choose the option that best suits your needs below.</p>
</div>
<div class="section" id="access-control-in-virtual-host">
<h3>Access Control in Virtual Host<a class="headerlink" href="#access-control-in-virtual-host" title="Permalink to this headline">¶</a></h3>
<p>Configuring Access Control within the Virtual Host Definition</p>
<p>Begin by opening up the virtual host file that you wish to add a restriction to. For our example, we’ll be using the <code class="docutils literal notranslate"><span class="pre">000-default.conf</span></code> file that holds the default virtual host installed through Ubuntu’s apache package:</p>
<p>Inside, with the comments stripped, the file should look similar to this:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">/etc/apache2/sites-enabled/000-default.conf</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;
</pre></div>
</td></tr></table></div>
</div>
<p>Authentication is done on a per-directory basis. To set up authentication, you will need to target the directory you wish to restrict with a <code class="docutils literal notranslate"><span class="pre">&lt;Directory</span> <span class="pre">___&gt;</span></code> block. In our example, we’ll restrict the entire document root, but you can modify this listing to only target a specific directory within the web space.
Within this directory block, specify that we wish to set up <strong>Basic authentication</strong>. For the <strong>AuthName</strong>, choose a realm name that will be displayed to the user when prompting for credentials. Use the <strong>AuthUserFile</strong> directive to point Apache to the password file we created. Finally, we will require a valid-user to access this resource, which means anyone who can verify their identity with a password will be allowed in:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">/etc/apache2/sites-enabled/000-default.conf</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    &lt;Directory &quot;/var/www/html&quot;&gt;
        AuthType Basic
        AuthName &quot;Restricted Content&quot;
        AuthUserFile /etc/apache2/.htpasswd
        Require valid-user
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</pre></div>
</td></tr></table></div>
</div>
<p>Save and close the file when you are finished. Restart Apache to implement your password policy:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo service apache2 restart
</pre></div>
</div>
<p>The directory you specified should now be password protected.</p>
<p>Configuring Access Control with <code class="docutils literal notranslate"><span class="pre">.htaccess</span></code> Files</p>
<p>If you wish to set up password protection using <code class="docutils literal notranslate"><span class="pre">.htaccess</span></code> files instead, you should begin by editing the main Apache configuration file to allow <code class="docutils literal notranslate"><span class="pre">.htaccess</span></code> files:</p>
<p>Find the <code class="docutils literal notranslate"><span class="pre">&lt;Directory&gt;</span></code> block for the <code class="docutils literal notranslate"><span class="pre">/var/www</span></code> directory that holds the document root. Turn on <code class="docutils literal notranslate"><span class="pre">.htaccess</span></code> processing by changing the <strong>AllowOverride</strong> directive within that block from <code class="docutils literal notranslate"><span class="pre">None</span></code> to <code class="docutils literal notranslate"><span class="pre">All</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">/etc/apache2/apache2.conf</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">&lt;</span><span class="n">Directory</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/&gt;</span>
    <span class="n">Options</span> <span class="n">Indexes</span> <span class="n">FollowSymLinks</span>
    <span class="n">AllowOverride</span> <span class="n">All</span>
    <span class="n">Require</span> <span class="nb">all</span> <span class="n">granted</span>
<span class="o">&lt;/</span><span class="n">Directory</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Next, we need to add an .htaccess file to the directory we wish to restrict. In our demonstration, we’ll restrict the entire document root (the entire website) which is based at <code class="docutils literal notranslate"><span class="pre">/var/www/html</span></code>, but you can place this file in any directory you wish to restrict access to <code class="docutils literal notranslate"><span class="pre">/var/www/html/.htaccess</span></code>.</p>
<p>Within this file, specify that we wish to set up <strong>Basic authentication</strong>. For the <strong>AuthName</strong>, choose a realm name that will be displayed to the user when prompting for credentials. Use the <strong>AuthUserFile</strong> directive to point Apache to the password file we created. Finally, we will require a valid-user to access this resource, which means anyone who can verify their identity with a password will be allowed in:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">/var/www/html/.htaccess</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">AuthType</span> <span class="n">Basic</span>
<span class="n">AuthName</span> <span class="s2">&quot;Restricted Content&quot;</span>
<span class="n">AuthUserFile</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apache2</span><span class="o">/.</span><span class="n">htpasswd</span>
<span class="n">Require</span> <span class="n">valid</span><span class="o">-</span><span class="n">user</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Save and close the file. Restart the web server to password protect all content in or below the directory with the <code class="docutils literal notranslate"><span class="pre">.htaccess</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo service apache2 restart
</pre></div>
</div>
<p>To confirm that your content is protected, try to access your restricted content in a web browser. You should be presented with a username and password prompt.</p>
<p>If you enter the correct credentials, you will be allowed to access the content. If you enter the wrong credentials or hit “Cancel”, you will see the “Unauthorized” error page:</p>
</div>
</div>
</div>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

              </div>
              
              
          </main>
          

      </div>
    </div>

    <script src="../../../_static/js/index.js"></script>
    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-20699788-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2004-2020, tschinz.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>